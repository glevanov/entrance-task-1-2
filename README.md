# Задание 1 — найди ошибки

В этом репозитории находятся материалы тестового задания "Найди ошибки" для [14-й Школы разработки интерфейсов](https://academy.yandex.ru/events/frontend/shri_msk-2018-2) (осень 2018, Москва, Санкт-Петербург, Симферополь).

Для работы тестового приложения нужен Node.JS v9. В проекте используются [Yandex Maps API](https://tech.yandex.ru/maps/doc/jsapi/2.1/quick-start/index-docpage/) и [ChartJS](http://www.chartjs.org).

## Задание

Код содержит ошибки разной степени критичности. Некоторые из них — стилистические, а другие — даже не позволят вам запустить приложение. Вам нужно найти все ошибки и исправить их.

Пункты для самопроверки:

1. Приложение должно успешно запускаться.
1. По адресу http://localhost:9000 должна открываться карта с метками.
1. Должна правильно работать вся функциональность, перечисленная в условиях задания.
1. Не должно быть лишнего кода.
1. Все должно быть в едином codestyle.

## Запуск

```
npm i
npm start
```

При каждом запуске тестовые данные генерируются заново случайным образом.

## Ход решения
1. Первым делом запускаю проект и смотрю в консоль ноды. Вываливается **ошибка при экспорте в модуле map** - при экспорте не хватает default (добавляю, ошибка уходит).
1. Глаз зацепился за **var** в том же модуле, а это неконсистентно общему стилю (ES6). Меняем на const в map и filter.
1. Проверяем на ошибки. В ноде и в консоли браузера их нет.
1. Приложение сообщило в консоль о запуске (init), но карта не отрисовывается. Проверяем, правильно ли встроена карта. Открываю раздел документации «быстрый старт» и вижу, что проблема уже на втором шаге - **контейнер карты нулевого размера**, что недопустимо. Через style явно задаем размеры контейнера в 100% вьюпорта (vh/vw) (это позволяет размеру карты менялся вместе с размером окна).
1. Карта отрисовывается, а идеи закончились. Перечитываю код на соответствие документации и нахожу первую ошибку, которая вроде бы ни на что не влияет - в модуле map в objectManager.clusters.options.set **вместо объекта передаются две строки**. Исправляю на объект с ключом и значением.
1. В модуле mappers нашел **двойные кавычки вместо одинарных**. Исправляю здесь в index на одинарные.
1. Также в mappers обнаружил, что в coordinates **перепутаны местами lat и lon**. Исправил.
1. Не смотря на все фиксы на карте до сих пор не отрисовываются точки. Это повод изучить, как их вообще надо отрисовывать. Из примера в «быстром старте» мы видим, что в этом проекте **пропущено добавление точек на карту**. Поэтому в модуле map нужно добавить myMap.geoObjects.add(), куда положить в качестве аргумента наши точки наш objectManager. 
1. Далее - на карте нет кластеров с красными точками, все точки одинакового цвета. Путем вбивания в поиск по документации значений, которые могут отвечать за внешний вид, обнаружил, что **проблема в пресете greenClusterIcons**. Если его удалить, кластеры становятся разноцветными.
1. Следующая проблема - открытием Balloon по клику на пин не возле метки. Изучая в коде всё что связано с Balloon доходим до строчки с **geoObjectBalloonContentLayout**. Если её закомментировать, Balloon отрисовывается возле пина. Значит проблема где-то здесь.
1. geoObjectBalloonContentLayout оказался не виноват. К своему стыду следующую проблему я искал долго, хотя недавно сам рассказывал на митапе об **особенности стрелочных функции — у них нет своего this**. Переписать методы в модуле details на function кажется неплохим решением.
1. В details в шаблоне обнаружен **незакрытый div**. Вроде бы без него работает, но непорядок.
1. После ручной правки отступов задумался, что надо автоматизировать. Я знаю про решения типа Prettier или Standard, но здесь решил не усложнять и использовать функцию WebStorm Refactor Code для приведения кода в единообразный вид. Также сконвертирую функции в стрелочные.
1. Неожиданно для меня заработал фильтр, хотя целенаправленно я его не чинил.
1. Далее - некорректное отоборажение графика нагрузки. Логично проверить модуль chart.js. Построчный анализ выявил **некорректное ограничение максимальной шкалы нагрузки по оси Y (max: 0)**. Если его убрать, график начинает работать как надо.

##TODO
* неиспользуемая функция в модуле popup
* ошибочно использована переменная htmlInfo 
